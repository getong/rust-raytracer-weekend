{
  "version": 3,
  "sources": ["../rtw-timer.js", "../wasm-app.js"],
  "sourcesContent": ["export default class Timer extends HTMLElement {\n    constructor() {\n        super();\n        this.attachShadow({mode: 'open'});\n        this.active = false;\n        this.paused = false;\n\n        this.shadowRoot.innerHTML = `\n        <label>\n            <meter optimum=0 low=500 high=1000 value=0 max=1500></meter>\n            <span id=\"label-text\"></span>\n        </label>\n        `;\n\n        this.labelText = this.shadowRoot.querySelector(\"#label-text\");\n        this.meter = this.shadowRoot.querySelector(\"meter\");\n\n        this.step = this.step.bind(this);\n    }\n\n    start() {\n        if (!this.paused) {\n            this.startTime = performance.now();\n        } else {\n            this.paused = false;\n        }\n        this.active = true;\n        requestAnimationFrame(this.step);\n    }\n\n    pause() {\n        this.paused = true;\n    }\n\n    step() {\n        if (this.active && !this.paused) {\n            const diff = performance.now() - this.startTime;\n            this.setLabel(`${diff.toFixed(2)}ms`);\n            this.meter.value = diff;\n            requestAnimationFrame(this.step);\n        }\n    }\n\n    stop() {\n        this.active = false;\n    }\n\n    setLabel(msg) {\n        this.labelText.innerText = msg;\n    }\n}\ncustomElements.define(\"rtw-timer\", Timer);\n", "// import init, {render} from \"./pkg/wasm.js\";\nimport \"./rtw-timer.js\";\n\nconst btn = document.querySelector(\"button\");\nconst canvas = document.querySelector('canvas');\nconst timers = document.querySelector(\"#timers\");\nlet timer;\n\ncanvas.width = 3 * 100;\ncanvas.height = 3 * 66;\nconst ctx = canvas.getContext('2d');\n\n// calculate the URL of the worker as being relative to this file\nconst workerUrl = new URL(`${import.meta.url}/../wasm-worker.js`);\nconst worker = new Worker(workerUrl.href, {type: \"module\"});\nworker.postMessage(\"init\");\n\nworker.addEventListener('message', async e => {\n    if (e.data.status === \"success\") {\n        if (e.data.data.imageData) {\n            drawImage(e.data.data.imageData);\n        } else if (e.data.data.initialized) {\n            btn.disabled = false;\n        }\n    } else if (e.data.status === \"error\") {\n        // error status probably indicates firefox's lack of support for module\n        // workers, so import the renderer directly and run it on the main\n        // thread.\n\n        // timer won't tick up anymore, so indicate that things will be block\n        timer.pause();\n        timer.setLabel(\"Web Worker failed, running on the main thread...\");\n\n        const {wasmRender} = await import(\"./wasm-render.js\");\n        drawImage(await wasmRender());\n\n        // restart the timer and step it once to update the total running time\n        timer.start();\n        timer.step();\n    }\n    timer && timer.stop();\n});\n\n/**\n * Begin the rendering, including starting a timer widget, starting render\n * within the wasm module, and writing the render result into the canvas.\n */\nfunction startRender() {\n    timer = addTimer();\n    clearImage();\n    timer.start();\n    worker.postMessage('render');\n}\n\nfunction addTimer() {\n    const newTimer = document.createElement(\"rtw-timer\");\n    const li = document.createElement(\"li\");\n    li.appendChild(newTimer);\n    timers.prepend(li);\n    return newTimer;\n}\n\nfunction drawImage(imageData) {\n    console.time(\"drawing canvas\");\n    ctx.putImageData(imageData, 0, 0);\n    console.timeEnd(\"drawing canvas\");\n}\n\nfunction clearImage() {\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n}\n\nbtn.addEventListener(\"click\", startRender);\n"],
  "mappings": "AAAA,mBAAmC,aAC/B,cACI,QACA,KAAK,aAAa,CAAC,KAAM,SACzB,KAAK,OAAS,GACd,KAAK,OAAS,GAEd,KAAK,WAAW,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA,UAO5B,KAAK,UAAY,KAAK,WAAW,cAAc,eAC/C,KAAK,MAAQ,KAAK,WAAW,cAAc,SAE3C,KAAK,KAAO,KAAK,KAAK,KAAK,MAG/B,QACI,AAAK,KAAK,OAGN,KAAK,OAAS,GAFd,KAAK,UAAY,YAAY,MAIjC,KAAK,OAAS,GACd,sBAAsB,KAAK,MAG/B,QACI,KAAK,OAAS,GAGlB,OACI,GAAI,KAAK,QAAU,CAAC,KAAK,QACrB,GAAM,GAAO,YAAY,MAAQ,KAAK,UACtC,KAAK,SAAS,GAAG,EAAK,QAAQ,QAC9B,KAAK,MAAM,MAAQ,EACnB,sBAAsB,KAAK,OAInC,OACI,KAAK,OAAS,GAGlB,SAAS,GACL,KAAK,UAAU,UAAY,IAhD5B,EAAP,EAmDA,eAAe,OAAO,YAAa,GChDnC,GAAM,GAAM,SAAS,cAAc,UAC7B,EAAS,SAAS,cAAc,UAChC,EAAS,SAAS,cAAc,WAClC,EAEJ,EAAO,MAAQ,EAAI,IACnB,EAAO,OAAS,EAAI,GACpB,GAAM,GAAM,EAAO,WAAW,MAGxB,EAAY,GAAI,KAAI,GAAG,YAAY,yBACnC,EAAS,GAAI,QAAO,EAAU,KAAM,CAAC,KAAM,WACjD,EAAO,YAAY,QAEnB,EAAO,iBAAiB,UAAW,KAAM,KACrC,GAAI,EAAE,KAAK,SAAW,UAClB,AAAI,EAAE,KAAK,KAAK,UACZ,EAAU,EAAE,KAAK,KAAK,WACf,EAAE,KAAK,KAAK,aACnB,GAAI,SAAW,YAEZ,EAAE,KAAK,SAAW,SAMzB,EAAM,QACN,EAAM,SAAS,oDAEf,GAAM,CAAC,cAAc,KAAa,4BAClC,EAAU,KAAM,MAGhB,EAAM,QACN,EAAM,OAEV,GAAS,EAAM,SAOnB,aACI,EAAQ,IACR,IACA,EAAM,QACN,EAAO,YAAY,UAGvB,aACI,GAAM,GAAW,SAAS,cAAc,aAClC,EAAK,SAAS,cAAc,MAClC,SAAG,YAAY,GACf,EAAO,QAAQ,GACR,EAGX,WAAmB,GACf,QAAQ,KAAK,kBACb,EAAI,aAAa,EAAW,EAAG,GAC/B,QAAQ,QAAQ,kBAGpB,aACI,EAAI,UAAU,EAAG,EAAG,EAAO,MAAO,EAAO,QAG7C,EAAI,iBAAiB,QAAS",
  "names": []
}
